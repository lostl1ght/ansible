#!/bin/bash

case "$1" in
    all | neovim) ;;
    *)
        if [[ -z "$1" ]]; then
            echo 'ERROR: no playbook chosen'
        else
            echo "ERROR: playbook '$1' not found"
        fi
        echo 'Usage: run <PLAYBOOK>'
        echo 'Playbooks:'
        echo '  all       Configure everyting'
        echo '  neovim    Configure neovim'
        exit 1
        ;;
esac

if [[ -z "$VIRTUAL_ENV" ]]; then
    source '.venv/bin/activate' >/dev/null 2>/dev/null
    if [[ $? -ne 0 ]]; then
        echo "Install a virtual env into '.venv' folder"
        exit 1
    fi
fi

ansible-playbook "$1-playbook.yml" -i "local.yml" -i "remote.yml" -e "@secrets.yml"

deactivate
